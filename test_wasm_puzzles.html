<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WASM Custom Solver Verification</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #111;
            color: #eee;
        }

        .log {
            white-space: pre-wrap;
            margin-bottom: 20px;
            border-bottom: 1px solid #333;
            padding-bottom: 20px;
        }

        .success {
            color: #4f4;
        }

        .error {
            color: #f44;
        }

        h2 {
            border-bottom: 1px solid #555;
        }
    </style>
</head>

<body>
    <h1>Heuristic BFS Solver (WASM) Verification</h1>
    <div id="output">Initializing...</div>

    <script type="module">
        import createFlowSolver from '/wasm/flow_solver_c.js';

        async function runTests() {
            const outputDiv = document.getElementById('output');
            outputDiv.innerHTML = '';

            const log = (msg, type = '') => {
                const div = document.createElement('div');
                div.className = 'log ' + type;
                div.textContent = msg;
                outputDiv.appendChild(div);
                console.log(msg);
            };

            try {
                log('Loading WASM module...');
                const Module = await createFlowSolver({
                    locateFile: (path) => {
                        if (path.endsWith('.wasm')) return '/wasm/flow_solver_c.wasm';
                        return path;
                    }
                });
                log('Module loaded successfully.', 'success');

                const solve = Module.cwrap('solve_puzzle_wasm', 'string', ['string']);

                const puzzles = [
                    {
                        "name": "extreme_10x10_01.txt",
                        "input": "..........\n..........\n..........\n......GY..\n........B.\n.....R....\n...G.....R\n....Y....O\n..........\n........OB\n"
                    },
                    {
                        "name": "extreme_10x10_30.txt",
                        "input": "..........\n..........\n........R.\n...CO.G...\n..Y.......\n...R......\n........O.\n..G....CB.\n.B........\n....Y.....\n"
                    },
                    {
                        "name": "extreme_11x11_07.txt",
                        "input": "...........\n..YB.......\n........R..\n........B..\n.....M..GC.\n.....R.....\n.....O.....\n...........\n..G.....M..\n...YCO.....\n...........\n"
                    },
                    {
                        "name": "extreme_11x11_15.txt",
                        "input": "...........\n..RB.....M.\n...........\nY.......Cm.\n....G......\n.....Y..O..\n...........\n..M........\nR..........\nmB.O.C.....\n...G.......\n"
                    },
                    {
                        "name": "extreme_11x11_20.txt",
                        "input": "...........\n...CB......\n...........\n...R....M..\n.....OY.G..\n.........B.\n...........\n..........O\n..M..R.....\n..........G\n........Y.C\n"
                    },
                    {
                        "name": "extreme_11x11_30.txt",
                        "input": "..........O\n.M.........\n.R....C....\n...........\nBm....YB...\n...........\n...........\n.....MG....\n...O.R..Y..\n.....m.C...\n.......G...\n"
                    },
                    {
                        "name": "extreme_12x12_01.txt",
                        "input": ".......M....\n.O.......B..\n...R........\n....C...m...\n....m..RG...\n............\nG.........Y.\n.C....MO....\n.B..........\n............\n.Y..........\n............\n"
                    },
                    {
                        "name": "extreme_12x12_02.txt",
                        "input": "............\n.B......m...\n.W..GMm..M..\n....YP......\n....B.......\n............\n.Y......C...\n............\n............\nWPR.........\nCO..........\n.......ORG..\n"
                    },
                    {
                        "name": "extreme_12x12_28.txt",
                        "input": "............\n............\n.........B..\n........C...\n........O...\n.....Y....R.\n........G...\n..........B.\n............\n....C......G\n..........OR\n.....Y......\n"
                    },
                    {
                        "name": "extreme_12x12_29.txt",
                        "input": "............\n....R.....m.\n...Cm.......\n.......B....\n....M..C....\n.......Y.O..\n............\n.R..G.P.....\n........M...\n.......G....\n.P.......Y..\n.OB.........\n"
                    },
                    {
                        "name": "extreme_12x12_30.txt",
                        "input": "...........C\n............\n............\n............\n............\n.....CMB....\nO........Y..\n............\nY...R.......\n....G.......\n.B.O........\n.........GRM\n"
                    },
                    {
                        "name": "extreme_8x8_01.txt",
                        "input": "........\n.O......\n........\n.....R..\n...Y...G\n.R..B..O\n.......G\nY......B\n"
                    },
                    {
                        "name": "extreme_9x9_01.txt",
                        "input": ".........\n......RY.\n.........\n.........\n....G....\n.........\n......Y..\n.....RGB.\n.....B...\n"
                    },
                    {
                        "name": "extreme_9x9_30.txt",
                        "input": ".........\nOC.....G.\n.........\n.B...YC..\n..O..B...\n..R......\n..G......\n........R\n........Y\n"
                    },
                    {
                        "name": "jumbo_10x10_01.txt",
                        "input": "R....B...B\n...W......\n..WG......\n.COm..O...\n.g....m.G.\n........A.\n..R..M...C\nYA........\n.P....g.M.\n.Y..P.....\n"
                    },
                    {
                        "name": "jumbo_11x11_01.txt",
                        "input": "...........\n......Y.W.M\n......A.O..\n.AYC.......\n..g.....C..\n.g.........\n.O.......R.\n.B..M..W...\n.....B.P...\nR......G..P\nm.......m.G\n"
                    },
                    {
                        "name": "jumbo_12x12_30.txt",
                        "input": "C...........\n..T.......O.\n............\n..C.........\n..M...P.....\n........b.B.\n.ATOP...W.bM\n...B..YG.g..\n...m........\n......R.....\n..A.....R..g\n....m.YG...W\n"
                    },
                    {
                        "name": "jumbo_13x13_26.txt",
                        "input": "Y..Y........B\nP..g......T..\nW..T........B\nM..CRg.......\n.............\n..........m..\n........G.G..\n........C....\n....M...PA...\nO............\n..W........m.\n.......R...A.\n.O...........\n"
                    },
                    {
                        "name": "jumbo_14x14_01.txt",
                        "input": "..............\n.b...b........\n...........c..\n........T.....\n.P........Y...\n...Rc.g.......\n..C.C..R......\nY......g...W..\n....W..O.B....\n....G..G.A....\n..MO.........m\n....M.....B...\n............P.\n.......A.Tm...\n"
                    },
                    {
                        "name": "jumbo_14x14_02.txt",
                        "input": "MCG...........\n..............\n....O....B..A.\n............BW\n.R.......W....\n............YA\n..............\n..........m...\n.......G.PM...\n..........Y...\n......O...C...\n..............\nPmR...........\n..............\n"
                    },
                    {
                        "name": "jumbo_14x14_19.txt",
                        "input": "....GMm.......\n.M......O.....\n........YR....\n..C...........\n..............\n.A.A..........\n.......B...R..\n...........Y..\n.m............\n......OB......\n...........P..\n..WG..gC......\n......PW....g.\n..............\n"
                    },
                    {
                        "name": "jumbo_14x14_21.txt",
                        "input": "W...W.......c.\n..........O.P.\n.B.....M......\n..........Mm..\n...mO.Y.....P.\n..RAG.........\n..B...G......Y\n..R...........\n..C....T......\n........gb....\n..g..p....p.A.\n.T............\n.b.c.........C\n..............\n"
                    },
                    {
                        "name": "jumbo_14x14_30.txt",
                        "input": "..........P..P\n..............\n..YgOR........\n..........Cc..\n......OR..M...\n......C...b...\n..............\n..MA.......c..\n........B.BT..\n.g.......m....\n.W...W.A..m...\n.........bT...\n..G....G......\nY.............\n"
                    },
                    {
                        "name": "regular_5x5_01.txt",
                        "input": "R.G.Y\n..B.O\n.....\n.G.Y.\n.RBO.\n"
                    },
                    {
                        "name": "regular_6x6_01.txt",
                        "input": "GYC.RB\n....O.\n..C...\n..R...\nG.O...\nY.B...\n"
                    },
                    {
                        "name": "regular_7x7_01.txt",
                        "input": "......B\n.....OR\n.O.....\n...GC..\n..G.Y..\n....RY.\n.....BC\n"
                    },
                    {
                        "name": "regular_8x8_01.txt",
                        "input": "....R...\n....C.GY\n....GY.C\n...OB...\n....O...\n....B...\n........\n.R......\n"
                    },
                    {
                        "name": "regular_9x9_01.txt",
                        "input": ".........\n.RCB.....\n...CO.OB.\n.......M.\n.G.GR....\nYM.....mP\n.PY......\n.m.......\n.........\n"
                    },
                    {
                        "name": "unsolvable_cross.txt",
                        "input": "R...G\n.....\n.....\n.....\nG...R\n"
                    }
                ];

                let passed = 0;
                let failed = 0;

                for (const puzzle of puzzles) {
                    log(`\nTesting ${puzzle.name}...`);
                    const start = performance.now();
                    const result = solve(puzzle.input);
                    const end = performance.now();

                    if (result && !result.startsWith('Error')) {
                        // Format the output for display (truncate if too long)
                        const displayResult = result.length > 100 ? result.substring(0, 100) + '...' : result;
                        log(`Result length: ${result.length} chars`);
                        log(`Success! Time: ${(end - start).toFixed(2)}ms`, 'success');
                        passed++;
                    } else {
                        log(`Failed: ${result}`, 'error');
                        failed++;
                    }
                }

                log(`\n\nTotal Tests: ${puzzles.length}`);
                log(`Passed: ${passed}`, 'success');
                log(`Failed: ${failed}`, failed > 0 ? 'error' : 'success');

            } catch (e) {
                log(`Fatal Error: ${e.message}`, 'error');
                console.error(e);
            }
        }

        runTests();
    </script>
</body>

</html>