import{r as i,R as y,j as e}from"./index-haNOZLP9.js";const q=()=>{const h=typeof SharedArrayBuffer<"u",N=5,B=[5,6,7,8,9,10,11,12,13,14,15],S={1:"#FF0000",2:"#0000FF",3:"#FFFF00",4:"#008000",5:"#FFA500",6:"#00FFFF",7:"#FF00FF",8:"#800000",9:"#800080",10:"#808080",11:"#FFFFFF",12:"#00FF00",13:"#D2B48C",14:"#00008B",15:"#008B8B",16:"#FFC0CB"},g=t=>Array(t).fill(null).map(()=>Array(t).fill(0)),[l,z]=i.useState(()=>{const t=localStorage.getItem("flow_solver_size");return t?parseInt(t,10):N}),[n,v]=i.useState(()=>{const t=localStorage.getItem("flow_solver_board");if(t)try{return JSON.parse(t)}catch(s){console.error("Failed to parse saved board",s)}return g(N)});y.useEffect(()=>{n.length!==l&&v(g(l))},[l]),y.useEffect(()=>{localStorage.setItem("flow_solver_size",l.toString())},[l]),y.useEffect(()=>{localStorage.setItem("flow_solver_board",JSON.stringify(n))},[n]);const[u,k]=i.useState(null),[m,f]=i.useState(1),[A,x]=i.useState(!1),[F,c]=i.useState(null),[b,w]=i.useState(!1),[j,C]=i.useState(null),T=i.useCallback((t=l)=>{const s=g(t);v(s),k(null),f(1),x(!1),c(null),C(null),localStorage.removeItem("flow_solver_board")},[l]),I=t=>{const s=parseInt(t.target.value);z(s),v(g(s)),k(null)},p=(t,s)=>t.flat().filter(d=>d===s).length,$=i.useCallback((t,s)=>{if(u)return;const d=n[t][s],o=n.map(a=>[...a]);if(d!==0){o[t][s]=0;const a=p(o,d);if(a===1)f(d),x(!0);else if(a===0){let r=1;for(;p(o,r)===2;)r++;f(r),x(p(o,r)===1)}}else{const a=p(n,m);if(a>=2){let r=m;for(;p(n,r)>=2&&r<=16;)r++;if(r>16)return;f(r),x(p(n,r)===1);return}if(o[t][s]=m,a===1){let r=m+1;for(;p(o,r)>=2&&r<=16;)r++;f(r),x(!1)}else x(!0)}v(o)},[n,u,m]),[_,E]=i.useState("z3");y.useEffect(()=>{h?sessionStorage.removeItem("sab_auto_fix"):sessionStorage.getItem("sab_auto_fix")||(console.log("Attempting silent fix for SharedArrayBuffer..."),sessionStorage.setItem("sab_auto_fix","true"),window.location.reload())},[h]);const R=async()=>{if(!h){w(!0),setTimeout(()=>{sessionStorage.removeItem("sab_auto_fix"),window.location.reload()},500);return}c(null),w(!0);const t=new Worker(new URL("/flow-free-solver/assets/solver.worker-DssHqh3q.js",import.meta.url),{type:"module"}),s=performance.now();t.postMessage({board:n,type:_}),t.onmessage=d=>{const o=d.data;if(w(!1),t.terminate(),o.board){const a=performance.now();C(a-s),k(o.board)}else o.timedOut?(c("Timed out (15s limit)"),setTimeout(()=>c(null),4e3)):o.error?(c("Solver error: "+o.error),setTimeout(()=>c(null),3e3)):(c("No solution found"),setTimeout(()=>c(null),3e3))},t.onerror=d=>{console.error("Worker error:",d),w(!1),c("Solver error"),setTimeout(()=>c(null),3e3),t.terminate()}},O=u||n;return e.jsxs("main",{className:"flex flex-col justify-center items-center h-[100dvh] w-full bg-stoic-bg safe-area-inset touch-manipulation overflow-hidden gap-6 sm:gap-8",children:[e.jsx("header",{className:"text-center flex flex-col items-center gap-1 selectable-text shrink-0",children:e.jsx("h1",{className:"text-stoic-primary text-xl sm:text-2xl md:text-3xl uppercase tracking-[0.2em] font-bold",children:"Flow Free Solver"})}),e.jsx("article",{"aria-label":"Puzzle Grid Board",className:"grid bg-stoic-line border-2 border-stoic-line mx-auto shrink-0",style:{gap:"2px",gridTemplateColumns:`repeat(${l}, 1fr)`,gridTemplateRows:`repeat(${l}, 1fr)`,width:"min(90vw, 55vh)",height:"min(90vw, 55vh)"},children:Array.from({length:l}).map((t,s)=>Array.from({length:l}).map((d,o)=>{const a=O[o]?.[s]??0,r=a!==0;return e.jsx("button",{type:"button",className:`
                                    group
                                    w-full h-full
                                    bg-stoic-block-bg
                                    p-0 m-0 appearance-none cursor-pointer 
                                    flex items-center justify-center 
                                    transition-all duration-150
                                    touch-manipulation
                                    select-none
                                    ${u?"cursor-default":"hover:bg-stoic-block-hover active:scale-95 active:bg-stoic-block-hover"}
                                `,onClick:()=>!u&&$(o,s),"aria-label":`Cell ${o},${s} ${r?`Color ${a}`:"Empty"}`,children:r?e.jsx("span",{className:"rounded-full w-[70%] h-[70%]",style:{backgroundColor:S[a]||"#888"}}):!u&&e.jsx("span",{className:"rounded-full w-[70%] h-[70%] opacity-0 group-hover:opacity-50 transition-opacity duration-75",style:{backgroundColor:S[m]||"#888"}})},`${o}-${s}`)}))}),e.jsxs("section",{"aria-label":"Game Controls",className:"flex flex-col items-center gap-6 shrink-0 z-10",children:[e.jsx("div",{role:"status",className:"flex items-center gap-3 min-h-[28px] selectable-text",children:b?e.jsxs("span",{className:"text-stoic-accent text-sm uppercase tracking-widest font-semibold flex items-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",fill:"none","aria-hidden":"true",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"3"}),e.jsx("path",{className:"opacity-100",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),h?"Solving…":"Connecting…"]}):F?e.jsxs("span",{className:"text-sm uppercase tracking-widest font-semibold animate-pulse",style:{color:"#FF3B30"},children:["✗ ",F]}):u?e.jsxs("span",{className:"text-stoic-accent text-sm uppercase tracking-widest font-semibold flex items-center gap-2",children:["✓ Solved",j!==null&&e.jsxs("span",{className:"text-stoic-secondary text-xs opacity-75",children:["(",j<1e3?`${Math.round(j)}ms`:`${(j/1e3).toFixed(2)}s`,")"]})]}):e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-stoic-primary text-sm uppercase tracking-wider font-medium",children:"Place"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"w-4 h-4 rounded-full",style:{backgroundColor:S[m]||"#888"}}),e.jsx("span",{className:"text-stoic-primary text-sm uppercase tracking-wider font-medium",children:A?"End":"Start"})]})]})}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("select",{className:"h-9 sm:h-10 pl-3 pr-7 text-xs border border-stoic-line bg-stoic-bg text-stoic-primary uppercase tracking-wide focus:outline-none focus:border-stoic-accent cursor-pointer appearance-none",value:l,onChange:I,"aria-label":"Grid Size",children:B.map(t=>e.jsxs("option",{value:t,children:[t,"×",t]},t))}),e.jsx("span",{className:"absolute right-2 top-1/2 -translate-y-1/2 text-stoic-secondary pointer-events-none text-[10px]",children:"▼"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{className:"h-9 sm:h-10 pl-3 pr-7 text-xs border border-stoic-line bg-stoic-bg text-stoic-primary uppercase tracking-wide focus:outline-none focus:border-stoic-accent cursor-pointer appearance-none",value:_,onChange:t=>E(t.target.value),"aria-label":"Solver Algorithm",children:[e.jsx("option",{value:"astar",children:"A*"}),e.jsx("option",{value:"z3",children:"SAT (Z3)"})]}),e.jsx("span",{className:"absolute right-2 top-1/2 -translate-y-1/2 text-stoic-secondary pointer-events-none text-[10px]",children:"▼"})]}),e.jsxs("button",{className:"h-9 sm:h-10 px-4 text-xs border-2 border-stoic-accent bg-stoic-accent text-stoic-bg font-bold uppercase tracking-wider hover:bg-transparent hover:text-stoic-accent transition-colors disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-stoic-accent disabled:hover:text-stoic-bg select-none flex items-center gap-2",onClick:R,disabled:b,children:[b&&e.jsxs("svg",{className:"animate-spin h-3 w-3",viewBox:"0 0 24 24",fill:"none","aria-hidden":"true",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"3"}),e.jsx("path",{className:"opacity-100",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),b?h?"Solving":"Connecting":"Solve"]}),e.jsx("button",{className:"h-9 sm:h-10 px-3 text-xs border border-stoic-line bg-transparent text-stoic-secondary uppercase tracking-wider hover:border-stoic-secondary hover:text-stoic-primary transition-colors select-none",onClick:()=>T(),children:"Reset"})]})]}),e.jsxs("footer",{className:"px-6 max-w-lg text-center text-stoic-secondary text-xs leading-relaxed selectable-text shrink-0",children:[e.jsxs("p",{children:["Interactive solver for Number Link puzzles.",e.jsx("br",{className:"hidden sm:block"}),"Supports 5×5 to 15×15 grids using SAT (Z3) & A* algorithms."]}),e.jsxs("div",{className:"mt-2 flex justify-center gap-4",children:[e.jsx("a",{href:"https://www.kongesque.com/",target:"_blank",rel:"noopener noreferrer",className:"hover:text-stoic-primary hover:underline transition-colors",children:"Author"}),e.jsx("a",{href:"https://github.com/Kongesque/flow-free-solver",target:"_blank",rel:"noopener noreferrer",className:"hover:text-stoic-primary hover:underline transition-colors",children:"GitHub"}),e.jsx("a",{href:"https://en.wikipedia.org/wiki/Numberlink",target:"_blank",rel:"noopener noreferrer nofollow",className:"hover:text-stoic-primary hover:underline transition-colors",children:"Wikipedia"})]})]})]})};export{q as default};
