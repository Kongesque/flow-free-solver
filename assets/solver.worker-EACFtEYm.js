(function(){"use strict";const P=[[-1,0],[1,0],[0,-1],[0,1]];class I{heap=[];compare;constructor(t){this.compare=t}push(t){this.heap.push(t),this.bubbleUp(this.heap.length-1)}pop(){if(this.heap.length===0)return;const t=this.heap[0],e=this.heap.pop();return this.heap.length>0&&e!==void 0&&(this.heap[0]=e,this.bubbleDown(0)),t}get length(){return this.heap.length}bubbleUp(t){for(;t>0;){const e=Math.floor((t-1)/2);if(this.compare(this.heap[t],this.heap[e])<0)[this.heap[t],this.heap[e]]=[this.heap[e],this.heap[t]],t=e;else break}}bubbleDown(t){for(;;){const e=2*t+1,h=2*t+2;let n=t;if(e<this.heap.length&&this.compare(this.heap[e],this.heap[n])<0&&(n=e),h<this.heap.length&&this.compare(this.heap[h],this.heap[n])<0&&(n=h),n!==t)[this.heap[t],this.heap[n]]=[this.heap[n],this.heap[t]],t=n;else break}}}class M{items={};head=0;tail=0;push(t){this.items[this.tail]=t,this.tail++}shift(){if(this.head===this.tail)return;const t=this.items[this.head];return delete this.items[this.head],this.head++,t}get length(){return this.tail-this.head}}const T=(s,t)=>{let e=null,h=null;for(let n=0;n<s.length;n++)for(let l=0;l<s[n].length;l++)if(s[n][l]===t)if(e===null)e=[n,l];else return h=[n,l],[e,h];return[e,h]},S=(s,t,e)=>{const h=s.length,n=Array(h).fill(null).map(()=>Array(h).fill(!1)),l=new I((p,i)=>p[0]-i[0]);for(l.push([0,0,t[0],t[1]]),n[t[0]][t[1]]=!0;l.length>0;){const[p,i,o,g]=l.pop();if(o===e[0]&&g===e[1])return i;for(const[E,w]of P){const r=o+E,u=g+w;if(r>=0&&r<h&&u>=0&&u<h&&!n[r][u]){if(r===e[0]&&u===e[1])return i+1;if(s[r][u]===0){n[r][u]=!0;const d=i+1,N=Math.abs(r-e[0])+Math.abs(u-e[1]),a=d+N;l.push([a,d,r,u])}}}}return 1/0},B=(s,t,e)=>{const h=s.map(n=>[...n]);for(const[n,l]of t)h[n][l]=e;return h},D=(s,t,e)=>{for(let h=e;h<=Object.keys(t).length;h++){const[n,l]=t[h];if(n&&l&&S(s,n,l)===1/0)return 1/0}return null},C=(s,t,e,h,n,l,p)=>{if(!h[e])throw new Error("No Solution Exists");const[i,o]=h[e];if(!i||!o)return[null,n];const g=S(s,i,o);if(g===1/0)return[null,n];if(D(s,h,e+1)===1/0)return[null,n];const w=new M;w.push([i[0],i[1],[i]]);const r=new Set;for(;w.length>0;){if(performance.now()-l>p)throw new Error("Timeout Exceeded");const u=w.shift(),[d,N,a]=u;if(d===o[0]&&N===o[1]){if(g<=a.length){const k=JSON.stringify(a);if(!r.has(k)){r.add(k);const b=s.map(m=>[...m]),c=B(b,a,e);n++;const f=e+1;if(h[f]){const m=t+a.length;if(m===s.length**2)return[c,n];const[v,y]=C(c,m,f,h,n,l,p);if(n=y,v)return[v,n]}else if(t+a.length===s.length*s.length)return[c,n]}}continue}for(const[k,b]of P){const c=d+k,f=N+b;if(c>=0&&c<s.length&&f>=0&&f<s[0].length){let m=!1;for(let y=0;y<a.length;y++)if(a[y][0]===c&&a[y][1]===f){m=!0;break}if(m)continue;const v=c===o[0]&&f===o[1];(s[c][f]===0||v)&&w.push([c,f,[...a,[c,f]]])}}}return[null,n]},O=s=>{const t=performance.now(),e={};let h=0;const n=Math.max(...s.flat());for(let i=1;i<=n;i++)if(e[i]=T(s,i),!e[i][0]||!e[i][1])throw new Error(`Number ${i} does not have a pair`);const l=1;let p=0;try{const[i,o]=C(s,h,l,e,p,t,15e3),g=performance.now();return[i,o,g-t]}catch{return[null,p,performance.now()-t]}},x=s=>{try{if(!s||s.length===0)return{board:null,timedOut:!1,timeTaken:0,nodeCount:0};const[t,e,h]=O(s),n=t===null&&h>=14900;return console.log(`Solved in ${h.toFixed(2)}ms, nodes: ${e}`),{board:t,timedOut:n,timeTaken:h,nodeCount:e}}catch(t){return console.error(t),{board:null,timedOut:!1,timeTaken:0,nodeCount:0}}};self.onmessage=s=>{const t=s.data,e=x(t);self.postMessage(e)}})();
